{% load md2 %}{% load i18n %}{% load settings %}
<article class="post clearfix" id="post{{post.pid}}" data-id="{{post.id}}">
    <div class="post-wrapper">
        <header class="clearfix">
            <div class="info-wrapper">
                {% if post.thread and post.is_op_post %}
                {% if post.thread.is_pinned %}<span class="is_pinned"></span>{% endif %}
                {% if post.thread.is_closed %}<span class="is_closed"></span>{% endif %}
                {% endif %}
                {% if post.data %}
                    {% if post.data.country %}
                        <span class="country">
                            <img src="{% setting 'STATIC_URL' %}/images/flags/{{post.data.country|lower}}.png" alt="{{post.data.country}}" title="{{post.data.country}}">
                        </span>
                    {% endif %}
                    {% if post.data.useragent %}
                        <span class="useragent">
                            <img src="{% setting 'STATIC_URL' %}images/useragents/{{post.data.useragent.name|lower}}.png" alt="{{post.data.useragent.name}}" title="{{post.data.useragent.raw}}">
                        </span>
                    {% endif %}
                {% endif %}
                <span class="number"><a href="{{thread.op_post.pid|default:""}}#post{{post.pid}}">{{post.pid}}</a></span>
                <time datetime="{{post.date|date:'c'}}" pubdate>{{post.date|date:"d.m.Y H:i:s"}}</time>
                <span class="poster">{% if post.email %}<a href="mailto:{{post.email}}" class="email">{% endif %}{{post.poster}}{% if post.email %}</a>{% endif %}</span>
                <span class="tripcode">{{post.tripcode}}</span>
                <span class="topic">{{post.topic}}</span>
            </div>
            <span title="{% trans 'Add to bookmarks' %}" class="post-icon bookmark add"></span>
            <span title="{% trans 'Hide' %}" class="post-icon hide add"></span></header>
        </header>
        <div class="content">
            {% if post.file_count > 0 %}
            {% for f in post.files %}
            <div class="file-info">
                <a target="_blank" href="{{f.file.url}}">{{post.pid}}.{{f.type.extension}}</a>
                (<em>{{f.size|filesizeformat}}{% if f.image_height %}, {{f.image_height}}x{{f.image_width}}{% endif %}</em>)
                <!--<a href="#image-edit" class="edit">G</a>-->
            </div>
            <div class="files">
                <a href="{{f.file.url}}">
                    {% if f.thumb %}
                        <img src="{{f.thumb.url}}" class="file" id="file{{f.id}}" data-hash="{{f.hash}}" alt="">
                    {% else %}
                        {% if f.image_height %}
                            <img src="{{f.file.url}}" class="file" id="file{{f.id}}" data-hash="{{f.hash}}" alt="">
                        {% else %}
                        {% if f.type.group.default_image %}
                            <img src="{{f.type.group.default_image.url}}" class="file-icon" id="file{{f.id}}" alt="">
                        {% endif %}
                        {% endif %}
                    {% endif %}
                </a>
            </div>
            {% endfor %}
            {% endif %}
            <div class="message">
                {% autoescape off %}{{ post.message|markdown2:"safe,videos,code-friendly,code-color" }}{% endautoescape %}
            </div>
        </div>
    </div>
</article>
